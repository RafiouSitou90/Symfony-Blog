{% extends 'base.html.twig' %}

{% block title %}{{ article.title }}{% endblock %}

{% block body %}
    <h1>Articles details page</h1>

    <h4>{{ article.title }}</h4>

    {{ include('articles/tags/_articles_tags.html.twig') }}

    {% if is_granted('IS_AUTHENTICATED_FULLY') %}
        {{ render(controller('App\\Controller\\CommentsController::createCommentForm', {'id': article.id})) }}
    {% else %}
        <p>
            <a href="{{ path('app_login', {'redirect_to': app.request.pathInfo}) }}">
                Login
            </a>
            to publish
        </p>
    {% endif %}

    <h3>
        Nb comments: {{ article.comments | length }}
    </h3>

    {% if article.comments | length > 0 %}
        {% for comment in article.comments %}
            <div class="">
                <h4 class="">
                    <strong>{{ comment.author.fullName }}</strong> Commented on
                    <strong>{{ comment.publishedAt|date('d/m/Y H:i') }}</strong>
                    {% if comment.author == app.user %}
                        <a href="{{ path('app_comments_edit', {'id': comment.id}) }}">Edit</a>
                        {{ include('comments/delete/_delete_form.html.twig') }}
{#                        <a href="#" id="comment_{{ comment.id }}">Delete</a>#}
                    {% endif %}
                </h4>
                <div class="">
                    {{ comment.content | raw }}
                </div>

                <a href="{{ path('app_comments_responses_new', {'commentId': comment.id}) }}">
                    Answer
                </a>


                {% if comment.commentResponses | length > 0 %}
                    <br>
                    <div>
                        <h2>Comment Responses</h2>
                        {% for commentResponse in comment.commentResponses %}
                            <div>
                                <h4 class="">
                                    <strong>{{ commentResponse.author.fullName }}</strong> Answered on
                                    <strong>{{ commentResponse.publishedAt|date('d/m/Y H:i') }}</strong>
                                    {% if commentResponse.author == app.user %}
                                        <a href="{{ path('app_comments_responses_edit', {'id': commentResponse.id}) }}">Edit</a>
                                        {{ include('comments_responses/delete/_delete_form.html.twig') }}
                                    {% endif %}
                                </h4>
                                <div class="">
                                    {{ commentResponse.content | raw }}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    {% else %}
        <div class="post-comment">
            <p>No comments</p>
        </div>
    {% endif %}

{% endblock %}
